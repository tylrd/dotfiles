#!/usr/bin/env bash

source ~/.git_prompt.sh

GIT_PS1_SHOWDIRTYSTATE=1
_GCP_SHOW_PROJECT=${GCP_SHOW_PROJECT:-"1"}

PROMPT_COMMAND="__prompt_command; ${PROMPT_COMMAND}"

google_project() {
  if [[ ! -z "$GOOGLE_PROJECT" ]]; then
    echo "[ $GOOGLE_PROJECT ]"
  fi
}

__prompt_command() {
    local curr_exit="$?"
    PS1=""

    local RCol='\[\e[0m\]'
    local Gre='\[\e[0;32m\]'
    local BYel='\[\e[1;33m\]'
    local Red='\[\e[0;31m\]'
    local Blu='\[\e[0;34m\]'

    if [ "$curr_exit" != 0 ]; then
        PS1+="${Red}\u${RCol}"
    else
        PS1+="\u"
    fi

    pwd2=$(p="${PWD#${HOME}}"; [ "${PWD}" != "${p}" ] && printf "~";IFS=/; for q in ${p:1}; do printf /${q:0:1}; done; printf "${q:1}")

    PS1+="${RCol}@\h:${Blu}$pwd2${BYel}$(__git_ps1 " (%s)") ${Gre}$(google_project) ${RCol}\n$ "
}
